<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta
	name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no"
	/>
	<meta name="description" content="" />
	<meta name="author" content="" />
	<link
	href="https://fonts.googleapis.com/css?family=Lato:100,300,400,700,900"
	rel="stylesheet"
	/>
	<link rel="icon" type="image/png" href="images/author-image.png" />
	<title>UHospital_Registro</title>
<!--
Reflux Template
https://templatemo.com/tm-531-reflux
-->
<!-- Bootstrap core CSS -->
<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" />

<!-- Additional CSS Files -->
<!--

<link rel="stylesheet" href="{{url_for('static',filename='/css/fontawesome.css')}}" />
<link rel="stylesheet" href="{{url_for('static',filename='/css/templatemo-style.css')}}" />
<link rel="stylesheet" href="{{url_for('static',filename='/css/owl.css')}}" />
<link rel="stylesheet" href="{{url_for('static',filename='/css/lightbox.css')}}" />

-->



<link rel="stylesheet" href="css/fontawesome.css" />
<link rel="stylesheet" href="css/templatemo-style.css" />
<link rel="stylesheet" href="css/owl.css" />
<link rel="stylesheet" href="css/lightbox.css" />

</head>
<body>
<div id="page-wraper">
<!-- Sidebar Menu -->

<div class="responsive-nav">
	<i class="fa fa-bars" id="menu-toggle"></i>
	<div id="menu" class="menu">
		<i class="fa fa-times" id="menu-close"></i>
		<div class="container">
			<div class="image">
				<a href="#"><img src="images/author-image.png" alt="" /></a>
			</div>
			<div class="author-content">
				<h4>UHospital</h4>
				<span>UHospital</span>
				
			</div>
			<nav class="main-nav" role="navigation">
				<ul class="main-menu">
					<li><button onclick="Cambio()" type "button" class="btn btn-danger btn-block">Pagina "Inicio sesion"</button></li>
					
				</ul>
			</nav>
			<div class="social-network">
				<ul class="soial-icons">
					<li>
						<a href="https://www.facebook.com/tamsk99j/"
						><i class="fa fa-facebook"></i
							></a>
						</li>
						
					</ul>
				</div>
				<div class="copyright-text">
					<p>Pagina por Tomas Morales Saquic - 201900364</p>
				</div>
			</div>
		</div>
	</div>

	<section class="section about-me">
		<div class="container">
			<div class="section-heading">
				<h2>UHospital - Registro de paciente.</h2>
				<div class="line-dec"></div>
				<span>
					**Llene los campos que se le solicitan para poder generar una cuenta.**
				</span
				>
			</div>
			<center>
			<div style="width: 40%;">
				<!-- Los form vienen de la pagina de Boostrap.
				  recordar agregarle un id a los componentes que vamos a utilizar
				  en este caso los input (Entradas de datos) llevan un id.
				  Segun el type, es el tipo de dato que recibe el input. -->
			  <form>

                <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="Nombre" placeholder="Nombre">
                    <label for="floatingInput">Nombre completo</label>
                </div>
                  <div class="form-floating">
                    <input type="text" class="form-control" id="Apellido" placeholder="Apellido">
                    <label for="floatingPassword">Apellido completo</label>
                  </div>
                  
                  
                  <div class="btn-group" role="group" aria-label="Basic example">
                      <button type="button" class="btn btn-outline-danger" id = "bt1" onclick="Mas()">MASCULINO</button>
                      <button type="button" class="btn btn-outline-danger" id = "bt2" onclick="Fem()">FEMENINO</button>
                      
                  </div>

                  
                  <label for="floatingInput">Genero del paciente.</label>
                  <br>
                  <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="User" placeholder="Nombre_Usuario">
                    <label for="floatingInput">Nombre de usuario</label>
                </div>
                
                <div class="form-floating">
                    <input type="password" class="form-control" id="contrasenia" placeholder="contrase単a">
                    <label for="floatingPassword">Contrase単a</label>
                  </div>

				  <div class="form-floating">
                    <input type="password" class="form-control" id="contrasenia-confirmacion" placeholder="confirmar contrase単a">
                    <label for="floatingPassword">Confirmar-Contrase単a</label>
                  </div>

                  <div class="mb-3">
                    <input type="number" class="form-control" id="numero" placeholder="Digite su numero de telefono">
                    <label for="floatingInput">Numero telefonico</label>
                  </div>

                  <div style="width: 100%; ">
                    <input type="date" name="fecha" id = "fecha">    
                  </div>
                  <label for="floatingInput">Fecha de nacimiento </label>
                  <br><br>
                  <button  onclick="revision()" type="button" class="btn btn-outline-light">Registrar</button>
			 </form>
		  </div>
		</center>

		</div>
</section>
</div>

<!-- Scripts -->
<!-- Bootstrap core JavaScript -->
<script src="jquery/jquery.min.js"></script>
<script src="bootstrap/js/bootstrap.bundle.min.js"></script>

<script src="js/isotope.min.js"></script>
<script src="js/owl-carousel.js"></script>
<script src="js/lightbox.js"></script>

  <script>
    var sexo = "M"
    function Fem(){
      sexo = "F"
    }
    function Mas(){
      sexo = "M"
    }

	  function Cambio(){
		location.href="Sesion.html"
	  }

	  
    function revision(){
      var cont = true
      fetch('https://backend-ipc-2021.herokuapp.com/Users', {
            method: 'GET',
            headers:{
                'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*',}})
            .then(res => res.json())
            .catch(err => {
                console.error('Error:', err)
                alert("Ocurrio un error, ver la consola")
            })
            .then(response =>{
               // console.log(response);
                // Usamos un foreach para darle el valor a un objeto dentro de un arreglo.

                // arreglo.forEach(variable => {que se hara dentro del for})
                response.forEach(element => {
                    // En este caso, element es el objeto que esta recorriendo el for, entonces por cada iteracion manipulamos a element
                    //console.log(element)
                    if(element.Username === document.querySelector('#User').value){
                      cont = false  
                    }  
                });
                if(cont){
                  agregarPaciente()
                }
                else{
                  alert("Error, un usuario ya cuenta con el nombre:  \""  +document.querySelector('#User').value+"\"  "+" intenta"
                  +" con otro nombre")  
                }
            }) 
    }
	  // METODO INSERTAR
	  function agregarPaciente(){
            
            // Console.log, nos sirve para imprimir informacion en la consola del navegador
            //console.log("Hola, me presionaste");
            /* OBTENIENDO INFORMACION
               Para declarar variables usamos el var variable
               
               Para encontrar un elemento en el html, usamos el metodo document.querySelector(#id)
               este metodo devuelve la etiqueta con todo y sus atributos.
            */
            var nombre = document.querySelector('#Nombre').value
            var apellido = document.querySelector('#Apellido').value
            var fecha = document.querySelector('#fecha').value
            console.log(fecha)
            var Username = document.querySelector('#User').value
            var contra = document.querySelector('#contrasenia').value
            var tel = document.querySelector('#numero').value
            var confirmacion = document.querySelector('#contrasenia-confirmacion').value
            /* CREANDO NUESTRO JSON
                Declaramos una variable y le asignamos un valor con llaves, simulando nuestro JSON
                dandole un clave - valor
            */
            if(nombre != "" && apellido != "" && fecha != "" && Username!="" ){
            if(contra.length>7){
            if(contra == confirmacion){
            
            var objeto = {
                
                'nombre': nombre,
                'apellido': apellido,
                'fecha': fecha,
                'sexo':sexo,
                'Username' : Username,
                'contra' : contra,
                'tel' : tel,
                'tipo': 3
            }
            console.log(objeto)

            /* EL METODO MAGICO - EL FETCH
            El fetch es el que nos permite crear peticiones HTTPS, la estructura es simple.
            Debemos de ingresarle una ruta, es la ruta del endpoint que queremos consumir, seguido de ello
            agregamos un objeto con los atributos de la peticion
                method: Puede ser GET, POST, PUT, DELETE
                body: Si el endpoint necesita un body, se le manda en este valor
                        - Agregarle el metodo JSON.stringify(objeto)
                headers: Estas normalmente no cambian, son las propiedades del metodo
            */
            fetch('https://backend-ipc-2021.herokuapp.com/cargaMasiva', {
            method: 'POST',
            body: JSON.stringify(objeto),
            headers:{
                'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*',}})

            
            .then(res => res.json())
            .catch(err => {
                console.error('Error:', err)
                alert("Ocurrio un error, ver la consola")
            })
            /* ULTIMA TRANSFORMACION
                Si el metodo funciono correctamente y se logro transformar la respuesta en un JSON, hara lo que este dentro de las llaves.
            */
            .then(response =>{
                // En este apargado, se haran las acciones si la respuesta fue correcta basicamente.
                //console.log(response);
                // Usamos un alert, para desplegar un mensaje en pantalla de parte del navegador
                // Esto se puede reemplazar con mas librerias.
                alert(response.Mensaje)
                if(response.verdadero){
                Cambio()
                }
                // Si quisieramos llamar un metodo definido, tambien es valido.
                
            })
            }
            else{
              alert("Las contrase単as no coinciden")  
            }
            }
            else{
              alert("La contrase単a debe contar con almenos 8 caracteres ") 
            }
            }
            else{
              alert("Por favor llene todos los campos (el numero telefonico es opcional)")  
            }
        }


  </script>
</body>
</html>
